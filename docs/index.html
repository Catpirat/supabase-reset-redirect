<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Procesando reset password...</title>
    <script>
      window.onload = () => {
        try {
          // 1. Lo que viene después de "#"
          const raw = decodeURIComponent(window.location.hash.substring(1));

          // 2. Parseamos la URL de Supabase que viene ahí
          const innerUrl = new URL(raw);

          // 3. Sacamos parámetros reales
          const token = innerUrl.searchParams.get("token");
          const type = innerUrl.searchParams.get("type");

          const redirectTo = "caparazonemocional://reset-password";

          if (type === "recovery" && token) {
            const deepLink = `${redirectTo}#access_token=${token}`;
            console.log("Redirigiendo a:", deepLink);
            window.location.href = deepLink;
          } else {
            document.body.innerHTML = `<h2>Error: token inválido o falta parámetro</h2>
                                      <p>Debug → raw: ${raw}</p>`;
          }
        } catch (err) {
          document.body.innerHTML = "<h2>Error procesando la redirección</h2><p>" + err + "</p>";
        }
      };
    </script>

  </head>
  <body>
    <h2>Procesando redirección...</h2>
    <p>Si no pasa nada, abre la app manualmente.</p>
  </body>
</html>
