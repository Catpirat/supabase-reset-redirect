<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Procesando reset password...</title>
    <script>
      window.onload = () => {
        try {
          const raw = decodeURIComponent(window.location.hash.substring(1));
          document.body.innerHTML = "<p>Procesando redirección...</p><p>Debug raw: " + raw + "</p>";

          const innerUrl = new URL(raw);
          const token = innerUrl.searchParams.get("token");
          const type = innerUrl.searchParams.get("type");

          const redirectTo = "caparazonemocional://reset-password";

          if (type === "recovery" && token) {
            const deepLink = `${redirectTo}#access_token=${token}`;
            document.body.innerHTML = `<p>Redirigiendo...</p>
                                      <p><a href="${deepLink}">${deepLink}</a></p>`;
            window.location.href = deepLink;
          } else {
            document.body.innerHTML += `<h2>Error: token inválido o falta parámetro</h2>`;
          }
        } catch (err) {
          document.body.innerHTML = "<h2>Error procesando la redirección</h2><p>" + err + "</p>";
        }
      };
    </script>

  </head>
  <body>
    <h2>Procesando redirección...</h2>
    <p>Si no pasa nada, abre la app manualmente.</p>
  </body>
</html>
